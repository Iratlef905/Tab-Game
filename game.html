<!DOCTYPE html>  
<html lang="en">
  <head>
    <!-- Meta and Title -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tab Game</title>

    <!-- Link to external CSS -->
    <link rel="stylesheet" href="gamestyle.css">
  </head>

  <body>
    <div class="grid-container">
      <div class="main-content">
        <div class="top-bar">
          <div class="login-container">
            <form>
              <input type="text" placeholder="Username">
              <input type="password" placeholder="Password">
              <button>Login</button>
            </form>
          </div>
          <h1>Tab Game</h1>
        </div>

        <hr class="divider">

        <div class="fields-container">
          <!-- BOARD SECTION -->
          <div class="field">
            <div class="controls">
              <label for="cols">Number of Columns:</label>
              <input type="number" id="cols" min="7" max="15" value="9" step="2">
              <button id="resetBtn">Reset Board</button>
            </div>
            <div class="board" id="board"></div>
          </div>

          <!-- Dice section -->
          <div class="field">Dice</div>

          <!-- Messages -->
          <div class="field message">Messages</div>
        </div>

        <!--Rules-->
        <div class="rules-section">
          <hr class="divider">
          <details>
            <summary><h2>Rules</h2></summary>
            <ul>
              <div class="rules-points">
                <details>
                  <summary><h3>The Board</h3></summary>
                  <ul>
                    <li>The board has four lines</li>
                    <li>The number of columns must be odd</li>
                  </ul>
                </details>
                <details>
                  <summary><h3>The Pieces</h3></summary>
                  <ul>
                    <li>Each player has as many pieces as the number of columns (blue for one, red for the other)</li>
                    <li>The transparency of the piece indicates its state: not moved, moved and been to last row</li>
                  </ul>
                </details>
                <details>
                  <summary><h3>Wooden Dice</h3></summary>
                  <ul>
                    <li>Must use 4 wooden sticks, with 2 different sides (dark and light sides)</li>
                    <li>After holding them and releasing them, you count the number of light sides </li>
                    <li>0 -> 6 spaces, 1 -> 1 space, 2 -> 2 spaces, 3 -> 3 spaces, 4 -> 4 spaces</li>
                    <li><b><u>Play again if result is 1, 4 or 6</u></b></li>
                  </ul>
                </details>
                <details>
                  <summary><h3>Moving the Pieces</h3></summary>
                  <ul>
                    <li>First time moving a piece is always 1 space (required to throw the dice)</li>
                    <li>Destination cannot have player pieces</li>
                    <li>On odd rows you can only move from rigth to left, and even rows left to right</li>
                    <li>Exiting the <u>1st</u> row you  can enter the <u>2nd</u>, and exiting the<u>2nd</u> you can enter the <u>3rd</u></li>
                    <li>Exiting the <u>3rd</u> row you can enter either the <u>4th</u> or <u>2nd</u> rows, and exiting <u>4th</u> you go back to the <u>3rd</u></li>
                    <li>If you land on an opponent piece, you capture it</li>
                    <li>Game ends when one player doesn´t have pieces on the board granting the other the win</li>
                  </ul>
                </details>
                <details>
                  <summary><h3>Restrictions</h3></summary>
                  <ul>
                    <li>Only one piece in each spot</li>
                    <li>A piece can only enter the <u>4th</u> row once</li>
                    <li>To move a piece inside the <u>4th</u> row you can´t have any in the <u>1st</u></li>
                    <li>A piece can´t go back to the <u>1st</u> row</li>
                  </ul>
                </details>
                <details>
                  <summary><h3>Restrictions</h3></summary>
                  <ul>
                    <li>Sometimes the dice won´t allow a valid move (for example: moving more than one space at the start)</li>
                    <li>In that case the player must give up their turn, <u>unless</u> there´s a valid move or chance to throw the dice again</li>
                  </ul>
                </details>
              </div>
            </ul>
          </details>
        </div>

        <hr class="divider">

        <!-- Scoreboard -->
        <div class="scoreboard">
          <h2>Scoreboard</h2>
          <table>
            <thead>
              <tr>
                <th>Player</th>
                <th>Best Result</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Player 1</td>
                <td>??</td>
              </tr>
              <tr>
                <td>Player 2</td>
                <td>??</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <aside class="sidebar">
        <ul>
          <li>Sidebar</li>
          <li>Settings</li>
          <li>link rules</li>
          <li>link score</li>
        </ul>
      </aside>
    </div>

    <script>
      // creates values to store references to html elements
      const board = document.getElementById("board");
      const colsInput = document.getElementById("cols");
      const resetBtn = document.getElementById("resetBtn");

      // function to generate initial board
      function generate_board(colunas = 9, linhas = 4) {
        board.innerHTML = ""; // clears board
        // defines the layout of the board as a grid
        board.style.gridTemplateColumns = `repeat(${colunas}, 80px)`;
        board.style.gridTemplateRows = `repeat(${linhas}, 80px)`;

        // runs through the board
        for (let linha = 0; linha < linhas; linha++) {
          for (let coluna = 0; coluna < colunas; coluna++) {
            const cell = document.createElement("div"); // creates element div -\
            cell.classList.add("cell"); // and assigns it the css class cell <--/

            // fills board with pieces
            if (linha === 0) {
              const piece = document.createElement("div");
              piece.classList.add("piece", "red");
              piece.draggable = true; // adds property to dragg
              cell.appendChild(piece); // adds piece to the cell (the board spot)
            } else if (linha === linhas - 1) {
              const piece = document.createElement("div");
              piece.classList.add("piece", "blue");
              piece.draggable = true; // adds property to drag
              cell.appendChild(piece); // adds piece to the cell (the board spot)
            }

            // drop and drag events
            cell.addEventListener("dragover", (e) => {
              e.preventDefault(); // allows the drop
            });

            cell.addEventListener("drop", (e) => {
              e.preventDefault();
              const dragged = document.querySelector(".dragging");
              if (dragged) {
                // allows to "destroy" a piece
                const existing = cell.querySelector(".piece");
                if (existing) existing.remove();
                cell.appendChild(dragged);
              }
            });

            board.appendChild(cell);
          }
        }

        // adds dragging
        const pieces = board.querySelectorAll(".piece");
        pieces.forEach((piece) => {
          piece.addEventListener("dragstart", () => {
            piece.classList.add("dragging");
          });
          piece.addEventListener("dragend", () => {
            piece.classList.remove("dragging");
          });
        });
      }

      // generates initial board
      generate_board();

      // Atualiza quando o valor mudar
      colsInput.addEventListener("input", (e) => {
        let colunas = parseInt(e.target.value) || 9;

        // makes sure of odd number
        if (colunas % 2 === 0) {
          colunas = colunas + 1; // adjusts
          e.target.value = colunas; // updates input
        }

        // makes sure its between limits
        if (colunas < 7) colunas = 7;
        if (colunas > 15) colunas = 15;

        generate_board(colunas);
      });

      // reset button
      resetBtn.addEventListener("click", () => {
        const colunas = parseInt(colsInput.value) || 9;
        generate_board(colunas);
      });
    </script>
  </body>
</html>
